#!/usr/bin/env sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸš€ Running pre-push checks..."

current_branch=$(git branch --show-current)
echo "ğŸ“‹ Current branch: $current_branch"

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ package.json
if [ ! -f package.json ]; then
    echo "âŒ package.json not found"
    exit 1
fi

# Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ»Ğ¸Ğ½Ñ‚Ğ¸Ğ½Ğ³
echo "ğŸ” Running ESLint..."
if npm run lint 2>/dev/null; then
    echo "âœ… ESLint passed"
else
    echo "âŒ ESLint failed! Fix errors before pushing."
    exit 1
fi

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ‚ĞµÑÑ‚Ñ‹
if npm run | grep -q "\"test\""; then
    echo "ğŸ§ª Running tests..."
    if npm run test -- --passWithNoTests --watchAll=false 2>/dev/null; then
        echo "âœ… Tests passed"
    else
        echo "âŒ Tests failed!"
        exit 1
    fi
else
    echo "âš ï¸  No tests configured, skipping"
fi

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑĞ±Ğ¾Ñ€ĞºÑƒ Ğ´Ğ»Ñ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ñ… Ğ²ĞµÑ‚Ğ¾Ğº
if [ "$current_branch" = "main" ] || [ "$current_branch" = "master" ] || [ "$current_branch" = "develop" ]; then
    echo "ğŸ—ï¸  Checking build..."
    if npm run build 2>/dev/null; then
        echo "âœ… Build successful"
    else
        echo "âŒ Build failed!"
        exit 1
    fi
fi

echo "ğŸ‰ All pre-push checks passed! Pushing to $current_branch..."